<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voco CRM - Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <style>
        /* ğŸ¨ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ÙˆØ§Ù„Ø®Ø·ÙˆØ· */
        body { 
            font-family: 'Cairo', sans-serif !important; 
            background-color: #f0f2f5; 
            margin: 0; 
            font-size: 14px; 
            direction: rtl;
            text-align: right;
        }
        h1, h2, h3, h4, h5, h6, th, .fw-bold { font-weight: 700; }
        
        /* ğŸ”´ Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„ÙÙ‚Ø§Ø¹Ø§Øª (Bubbles Effect) ğŸ”´ */
        @keyframes bubble {
            0% { transform: translateY(0); opacity: 0.6; }
            100% { transform: translateY(-700px); opacity: 0; }
        }

        .bubbles {
            position: absolute;
            bottom: -150px;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
            z-index: 1;
        }

        .bubbles li {
            position: absolute;
            display: block;
            list-style: none;
            width: 20px;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            animation: bubble 25s linear infinite;
            border-radius: 50%;
        }

        .bubbles li:nth-child(1) { left: 25%; width: 80px; height: 80px; animation-delay: 0s; }
        .bubbles li:nth-child(2) { left: 10%; width: 20px; height: 20px; animation-delay: 2s; animation-duration: 12s; }
        .bubbles li:nth-child(3) { left: 70%; width: 20px; height: 20px; animation-delay: 4s; }
        .bubbles li:nth-child(4) { left: 40%; width: 60px; height: 60px; animation-delay: 0s; animation-duration: 18s; }
        .bubbles li:nth-child(5) { left: 65%; width: 20px; height: 20px; animation-delay: 7s; }
        .bubbles li:nth-child(6) { left: 80%; width: 40px; height: 40px; animation-delay: 3s; animation-duration: 7s; }
        .bubbles li:nth-child(7) { left: 50%; width: 50px; height: 50px; animation-delay: 15s; animation-duration: 25s; }
        
        /* ğŸ”µ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (Sidebar) */
        .sidebar { 
            width: 250px; 
            height: 100vh; 
            background-color: #1e3a8a; 
            padding: 20px; 
            position: fixed; 
            top: 0; 
            right: 0; 
            z-index: 1000; 
            box-shadow: -5px 0 15px rgba(0,0,0,0.2); 
            transition: all 0.3s ease;
        }
        .sidebar a { 
            display: flex; 
            align-items: center; 
            padding: 12px 15px; 
            margin-bottom: 10px; 
            color: #d1d5db; 
            text-decoration: none; 
            border-radius: 10px; 
            transition: all 0.3s ease; 
        }
        .sidebar a:hover, .sidebar a.active { 
            background-color: #3b82f6; 
            color: white; 
            transform: translateX(-8px); 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .sidebar i { margin-left: 10px; width: 20px; text-align: center; }
        .sidebar .logo-text { color: white; font-weight: 900; font-size: 22px; margin-right: 10px; }

        .main-content { margin-right: 250px; padding: 30px; }
        
        /* âš™ï¸ ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
        .settings-card { 
            background: white; 
            border-radius: 20px; 
            padding: 25px; 
            margin-bottom: 25px; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.1); 
            border-right: 5px solid #FF5722; /* Ø´Ø±ÙŠØ· Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ø¬Ø§Ù†Ø¨ÙŠ */
            position: relative;
            overflow: hidden;
        }
        .settings-header { 
            color: #1e3a8a; 
            border-bottom: 1px solid #eee; 
            padding-bottom: 15px; 
            margin-bottom: 20px; 
            font-weight: 900;
            position: relative;
            z-index: 2;
        }
        
        .status-badge { padding: 8px 15px; border-radius: 20px; font-weight: bold; }
        .status-online { background-color: #e8f5e9; color: #2e7d32; }
        .status-offline { background-color: #ffebee; color: #c62828; }
        
        .btn-action { width: 100%; text-align: right; margin-bottom: 10px; padding: 12px; font-weight: bold; border-radius: 10px; transition: all 0.3s ease; }
        .btn-action:hover { box-shadow: 0 4px 8px rgba(0,0,0,0.1); transform: translateY(-2px); }

        /* ğŸŒ‘ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¸Ù„Ù… (Dark Mode Styles) ğŸŒ‘ */
        .dark-mode {
            background-color: #121212 !important; 
            color: #e0e0e0 !important; 
        }
        .dark-mode .sidebar {
            background-color: #1f1f1f !important; 
            box-shadow: -5px 0 15px rgba(255, 255, 255, 0.05);
        }
        .dark-mode .main-content h2,
        .dark-mode .settings-header {
            color: #bb86fc !important; 
        }
        .dark-mode .sidebar a {
            color: #b3b3b3;
        }
        .dark-mode .sidebar a:hover, .dark-mode .sidebar a.active {
            background-color: #3700b3 !important; 
            color: white !important;
        }
        .dark-mode .settings-card { 
            background-color: #1e1e1e !important;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
        }
        .dark-mode .list-group-item {
            background-color: transparent !important;
            border-bottom: 1px solid #333 !important;
        }
        .dark-mode .btn-light {
            background-color: #2c2c2c !important;
            color: #e0e0e0 !important;
            border-color: #3700b3 !important;
        }
    </style>
</head>
<body>

    <div class="sidebar" data-aos="fade-right" data-aos-duration="1200">
        <div class="d-flex align-items-center mb-5 border-bottom pb-3">
            <i class="fas fa-satellite-dish fa-2x" style="color: #FF5722; margin-left: 10px;"></i>
            <h5 class="mb-0 logo-text">VOCO CRM</h5>
        </div>
        <a href="dashboard.html"><i class="fas fa-tachometer-alt"></i>Dashboard (Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©)</a>
        <a href="reports.html"><i class="fas fa-chart-line"></i>Reports (Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±)</a>
        <a href="users.html"><i class="fas fa-users"></i>Users (Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†)</a>
        <a href="settings.html" class="active"><i class="fas fa-cog"></i>Settings (Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª)</a>
        
        <a href="#" onclick="toggleDarkMode(event)" id="darkModeToggle" style="margin-top: 50px;">
            <i class="fas fa-moon"></i> Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¸Ù„Ù…
        </a>
    </div>

    <div class="main-content">
        <h2 class="mb-4" style="color: #1E3A8A; font-weight: 900;" data-aos="fade-down" data-aos-duration="800">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h2>

        <div class="row">
            <div class="col-md-6" data-aos="fade-right" data-aos-delay="200">
                <div class="settings-card">
                    <h5 class="settings-header"><i class="fas fa-server"></i> Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠØ±ÙØ± ÙˆØ§Ù„Ø§ØªØµØ§Ù„</h5>
                    
                    <ul class="bubbles">
                        <li></li><li></li><li></li><li></li><li></li><li></li><li></li>
                    </ul>

                    <div style="position: relative; z-index: 2;">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span>Ø­Ø§Ù„Ø© Ø³ÙŠØ±ÙØ± Node.js:</span>
                            <span id="serverStatus" class="status-badge status-offline">Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span>Ù…Ù†ÙØ° Ø§Ù„Ø§ØªØµØ§Ù„ (Port):</span>
                            <span class="badge bg-secondary">3000</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <span>Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (PostgreSQL):</span>
                            <span class="status-badge status-online">Ù…ØªØµÙ„ <i class="fas fa-check"></i></span>
                        </div>
                        <button class="btn btn-outline-primary w-100 mt-4" onclick="checkServer()">
                            <i class="fas fa-sync"></i> Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„
                        </button>
                    </div>
                </div>
            </div>

            <div class="col-md-6" data-aos="fade-left" data-aos-delay="400">
                <div class="settings-card">
                    <h5 class="settings-header"><i class="fas fa-info-circle"></i> Ø­ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</h5>
                    <ul class="list-group list-group-flush" style="position: relative; z-index: 2;">
                        <li class="list-group-item d-flex justify-content-between">
                            <strong>Ø§Ø³Ù… Ø§Ù„Ù†Ø¸Ø§Ù…:</strong> <span>Voco Mini-CRM</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <strong>Ø§Ù„Ø¥ØµØ¯Ø§Ø±:</strong> <span>v1.0.0 (Stable)</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <strong>Ø§Ù„Ù…Ø·ÙˆØ±:</strong> <span>Muhammad Admin</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <strong>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</strong> <span id="lastUpdateDate"></span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="row" data-aos="fade-up" data-aos-delay="600">
            <div class="col-12">
                <div class="settings-card">
                    <h5 class="settings-header"><i class="fas fa-tools"></i> Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h5>
                    <div class="row" style="position: relative; z-index: 2;">
                        <div class="col-md-4">
                            <button class="btn btn-light btn-action border" onclick="window.location.href='dashboard.html'">
                                <i class="fas fa-home text-primary ms-2"></i> Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                            </button>
                        </div>
                        <div class="col-md-4">
                            <button class="btn btn-light btn-action border" onclick="exportToCSV()">
                                <i class="fas fa-file-csv text-success ms-2"></i> ØªØ­Ù…ÙŠÙ„ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© (CSV)
                            </button>
                        </div>
                        <div class="col-md-4">
                            <button class="btn btn-light btn-action border text-danger" onclick="alert('Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© ØªØªØ·Ù„Ø¨ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø£Ø¹Ù„Ù‰.')">
                                <i class="fas fa-power-off text-danger ms-2"></i> Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ø¤Ù‚ØªØ§Ù‹
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ§Ø±ÙŠØ®
        document.getElementById('lastUpdateDate').innerText = new Date().toLocaleDateString('ar-EG');
        const BASE_URL = 'https://voco-api-5zqm.onrender.com/api';

        // Ø¯Ø§Ù„Ø© ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
        async function checkServer() {
            const statusEl = document.getElementById('serverStatus');
            statusEl.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...';
            statusEl.className = 'status-badge bg-warning text-dark';

            try {
                await axios.get(`${BASE_URL}/visits`);
                
                statusEl.innerHTML = 'Ù…ØªØµÙ„ (Online) <i class="fas fa-check-circle"></i>';
                statusEl.className = 'status-badge status-online';
            } catch (error) {
                console.error(error);
                statusEl.innerHTML = 'ØºÙŠØ± Ù…ØªØµÙ„ (Offline) <i class="fas fa-times-circle"></i>';
                statusEl.className = 'status-badge status-offline';
            }
        }

        // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØµØ¯ÙŠØ± (Ù†ÙØ³ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯) Ù„Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
        async function exportToCSV() {
            try {
                const response = await axios.get(`${BASE_URL}/visits`);
                const visitsData = response.data.data;

                if (visitsData.length === 0) { alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª."); return; }

                const headers = ["Ø§Ù„ØªØ§Ø±ÙŠØ®", "Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨", "Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„", "Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø­ÙˆÙ„", "Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶", "Ø®Ø· Ø§Ù„Ø·ÙˆÙ„"];
                let csv = headers.join(',') + '\n';
                
                visitsData.forEach(visit => {
                    const row = [
                        `"${new Date(visit.created_at).toLocaleDateString()}"`,
                        `"${visit.rep_name || ''}"`,
                        `"${visit.customer_name || ''}"`,
                        `"${(visit.voice_text || '').replace(/"/g, '""')}"`, 
                        visit.lat,
                        visit.lng
                    ].join(',');
                    csv += row + '\n';
                });

                const blob = new Blob([new Uint8Array([0xEF, 0xBB, 0xBF]), csv], { type: 'text/csv;charset=utf-8;' }); 
                const link = document.createElement("a");
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", `Voco_Backup_${new Date().toISOString().slice(0, 10)}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } catch (e) {
                alert("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ± Ù„Ø¬Ù„Ø¨ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©.");
            }
        }

        // ğŸ”´ Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¸Ù„Ù… (Dark Mode) ğŸ”´
        function toggleDarkMode(event) {
            event.preventDefault(); 
            const body = document.body;
            body.classList.toggle('dark-mode');

            const isDarkMode = body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDarkMode ? 'enabled' : 'disabled');
            updateToggleIcon(isDarkMode);
        }

        function updateToggleIcon(isDarkMode) {
            const toggleButton = document.getElementById('darkModeToggle');
            if (toggleButton) {
                toggleButton.innerHTML = isDarkMode 
                    ? '<i class="fas fa-sun"></i> Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­' 
                    : '<i class="fas fa-moon"></i> Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¸Ù„Ù…';
            }
        }

        // ğŸ”´ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¸Ù„Ù… Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ğŸ”´
        document.addEventListener('DOMContentLoaded', () => {
            const darkModeSetting = localStorage.getItem('darkMode');
            const isDarkMode = darkModeSetting === 'enabled';
            
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
            }
            updateToggleIcon(isDarkMode);
        });


        // ØªØ´ØºÙŠÙ„ Ø§Ù„ÙØ­Øµ Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­
        checkServer();
    </script>
    
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        AOS.init({
            duration: 1000,
            once: true
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>